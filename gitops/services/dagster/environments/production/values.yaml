global:
  postgresqlSecretName: dagster-user

generatePostgresqlPasswordSecret: false

# Disable built-in PostgreSQL (using external CNPG cluster)
postgresql:
  enabled: false
  postgresqlHost: dagster-db-rw
  postgresqlUsername: dagster
  postgresqlDatabase: dagster

# Use external KeyDB as Redis/Celery broker
redis:
  enabled: true
  internal: false
  host: keydb.keydb.svc.cluster.local
  port: 6379

# Custom user code deployment with our data pipelines
dagster-user-deployments:
  enabled: true
  enableSubchart: true
  deployments:
    - name: "data-pipelines"
      image:
        repository: "ghcr.io/ibacalu/dagster-pipelines"
        tag: "latest"  # Update to specific version after first release
        pullPolicy: Always
      dagsterApiGrpcArgs:
        - "--module-name"
        - "dagster_pipelines.definitions"
      port: 3030
      nodeSelector:
        kubernetes.io/arch: amd64
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: 500m
          memory: 512Mi

# Use Celery executor with Redis as broker
runLauncher:
  type: CeleryK8sRunLauncher
  config:
    celeryK8sRunLauncher:
      nodeSelector:
        kubernetes.io/arch: amd64
      workerQueues:
        - name: "dagster"
          replicaCount: 2
          nodeSelector:
            kubernetes.io/arch: amd64

# Enable Flower for Celery monitoring
flower:
  enabled: true
  nodeSelector:
    kubernetes.io/arch: amd64
