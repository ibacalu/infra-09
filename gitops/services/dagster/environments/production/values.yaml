global:
  postgresqlSecretName: dagster-user

generatePostgresqlPasswordSecret: false

# Disable built-in PostgreSQL (using external CNPG cluster)
postgresql:
  enabled: false
  postgresqlHost: dagster-db-rw
  postgresqlUsername: dagster
  postgresqlDatabase: dagster

# Redis disabled (not needed without Celery)
redis:
  enabled: false
  internal: false
  host: keydb.keydb.svc.cluster.local
  port: 6379

# Custom user code deployment with our data pipelines
dagster-user-deployments:
  enabled: true
  enableSubchart: true
  deployments:
    - name: "data-pipelines"
      image:
        repository: "ghcr.io/ibacalu/dagster-pipelines"
        tag: "latest"  # TODO: Update to specific version
        pullPolicy: Always
      dagsterApiGrpcArgs:
        - "--module-name"
        - "dagster_pipelines.definitions"
      port: 3030
      nodeSelector:
        kubernetes.io/arch: amd64
      resources:
        requests:
          cpu: 100m
          memory: 256Mi
        limits:
          cpu: 500m
          memory: 512Mi

# Use K8s run launcher
runLauncher:
  type: K8sRunLauncher
  config:
    k8sRunLauncher:
      # Fail the K8s Job/Pod if the pipeline fails (enables KSM alerting)
      failPodOnRunFailure: true
      runK8sConfig:
        podSpecConfig:
          nodeSelector:
            kubernetes.io/arch: amd64
        jobSpecConfig:
          # Auto-delete completed/failed Jobs after 1 hour for faster alert resolution
          ttlSecondsAfterFinished: 3600

# Flower disabled (not needed without Celery)
flower:
  enabled: false
  nodeSelector:
    kubernetes.io/arch: amd64
